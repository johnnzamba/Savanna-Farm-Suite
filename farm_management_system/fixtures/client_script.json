[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Poultry Batches",
  "enabled": 1,
  "modified": "2025-09-04 20:35:55.305963",
  "module": "Savanna Farm Suite",
  "name": "Poultry Batch",
  "script": "frappe.ui.form.on('Poultry Batches', {\n    refresh(frm) {\n        // This function is called when the form is refreshed.\n\n        // Clear the existing chart container to prevent duplicates on reload\n        frm.fields_dict.profitability_analysis_for_this_batch.$wrapper.html(\"\");\n\n        // Add containers for the charts\n        frm.fields_dict.profitability_analysis_for_this_batch.$wrapper.html(`\n            <div class=\"frappe-card p-4\">\n                <h4 class=\"mb-4\">Weekly Feed Expense Analysis</h4>\n                <div id=\"feed-expense-chart-container\"></div>\n            </div>\n            <div class=\"frappe-card p-4 mt-4\">\n                <h4 class=\"mb-4\">Weekly Animal Product Stock Value</h4>\n                <div id=\"stock-value-chart-container\"></div>\n            </div>\n        `);\n\n        // Add a loading indicator\n        const expenseChartContainer = document.getElementById('feed-expense-chart-container');\n        const stockChartContainer = document.getElementById('stock-value-chart-container');\n        expenseChartContainer.innerText = 'Loading Expense Data...';\n        stockChartContainer.innerText = 'Loading Stock Value Data...';\n\n        // Call the server-side function to get processed chart data\n        frappe.call({\n            method: \"farm_management_system.savanna_farm_suite.doctype.poultry_batches.poultry_batches.get_profitability_chart_data\",\n            args: {\n                batch_name: frm.doc.name\n            },\n            callback: function(response) {\n                if (response.message) {\n                    const expenseData = response.message.expense_data;\n                    const stockData = response.message.stock_data;\n\n                    // --- Render Expense Chart ---\n                    if (expenseData && expenseData.labels && expenseData.labels.length > 0) {\n                        const expenseChart = new frappe.Chart(\"#feed-expense-chart-container\", {\n                            title: \"Weekly Feed Costs per Feed Type\",\n                            data: expenseData,\n                            type: 'line',\n                            height: 300,\n                            colors: ['#743ee2', '#ff5858', '#00a8ff', '#ffc312', '#2bcbba'],\n                            lineOptions: {\n                                regionFill: 1\n                            }\n                        });\n                    } else {\n                        expenseChartContainer.innerHTML = '<p class=\"text-muted\">No nourishment log data found for this batch to generate expense chart.</p>';\n                    }\n\n                    // --- Render Stock Value Chart ---\n                    if (stockData && stockData.labels && stockData.labels.length > 0) {\n                       const stockValueChart = new frappe.Chart(\"#stock-value-chart-container\", {\n                            title: \"Weekly Stock Value per Animal Product\",\n                            data: stockData,\n                            type: 'line',\n                            height: 300,\n                            colors: ['#ff6b6b', '#feca57', '#48dbfb', '#1dd1a1', '#5f27cd'],\n                             lineOptions: {\n                                regionFill: 0\n                            }\n                        });\n                    } else {\n                         stockChartContainer.innerHTML = '<p class=\"text-muted\">No stock ledger entries found for this batch to generate stock value chart.</p>';\n                    }\n\n                } else {\n                     expenseChartContainer.innerText = 'Failed to load chart data.';\n                     stockChartContainer.innerText = 'Failed to load chart data.';\n                }\n            }\n        });\n    }\n});\n",
  "view": "Form"
 }
]